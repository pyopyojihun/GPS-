clear all; clearvars
% A=[
%     0.720000000000D+02 0.828125000000D+01 0.549880047568D-08 -0.313278213583D+01;
%     0.365078449249D-06 0.156549897511D-01 0.486522912979D-05 0.515375015831D+04;
%     0.144000000000D+05 0.135973095894D-06 0.110361438761D+01 -0.175088644028D-06;
%     0.924939435326D+00 0.264781250000D+03 -0.199270210420D+01 -0.827320175492D-08;
%     0.175364447490D-09 0.000000000000D+00 0.183000000000D+04 0.000000000000D+00;
%     0.200000000000D+01 0.000000000000D+00 -0.111758708954D-07 0.720000000000D+02;
%     0.720000000000D+04 0.400000000000D+01 0.000000000000D+00 0.000000000000D+00;];

%  A=[
%     0.108000000000D+03 -0.203125000000D+02 0.514628579203D-08 0.819495259655D+00
%    -0.946223735809D-06 0.706251512747D-02 0.852346420288D-05 0.515358385849D+04
%     0.143360000000D+05 -0.577419996262D-07 0.212365340790D+01 0.147148966789D-06
%     0.934047428699D+00 0.200656250000D+03 0.370136842874D+00 -0.828391648694D-08
%    -0.501449458811D-09 0.000000000000D+00 0.183000000000D+04 0.000000000000D+00
%     0.200000000000D+01 0.000000000000D+00 -0.107102096081D-07 0.108000000000D+03
%     0.720000000000D+04 0.400000000000D+01 0.000000000000D+00 0.000000000000D+00];

%  A=[
%     0.830000000000D+02 0.968125000000D+02 0.451340228704D-08 -0.253458575487D+00;
%     0.505894422531D-05 0.298202654812D-02 0.903382897377D-05 0.515369125557D+04;
%     0.144000000000D+05 0.726431608200D-07 -0.308253171173D+01 0.186264514923D-08;
%     0.954977971123D+00 0.203062500000D+03 0.266350324549D+00 -0.802819154926D-08;
%     0.115719105880D-09 0.000000000000D+00 0.183000000000D+04 0.000000000000D+00;
%     0.280000000000D+01 0.000000000000D+00 0.232830643654D-08 0.830000000000D+02;
%     0.720000000000D+04 0.400000000000D+01 0.000000000000D+00 0.000000000000D+00];
% 
%  A=[0.530000000000D+02 -0.209375000000D+01 0.412088593715D-08 -0.363892483845D+00;
%    -0.225380063057D-06 0.535648548976D-02 0.101011246443D-04 0.515368959808D+04;
%     0.144000000000D+05 -0.100582838059D-06 0.227775312414D+01 -0.726431608200D-07;
%     0.975046300352D+00 0.192281250000D+03 0.206612615424D+01 -0.779746765297D-08;
%    -0.421803284086D-09 0.100000000000D+01 0.183000000000D+04 0.000000000000D+00;
%     0.200000000000D+01 0.000000000000D+00 -0.116415321827D-07 0.530000000000D+02;
%     0.721800000000D+04 0.400000000000D+01 0.000000000000D+00 0.000000000000D+00];
% 
%  A=[
%     0.430000000000D+02 0.122187500000D+02 0.522593196676D-08 0.240548108974D+01;
%     0.610947608948D-06 0.404094322585D-02 0.509992241859D-05 0.515375426865D+04;
%     0.144000000000D+05 -0.484287738800D-07 0.111429068476D+01 -0.186264514923D-07;
%     0.946360873078D+00 0.275250000000D+03 0.420545428902D+00 -0.834141888215D-08;
%     0.153220667970D-09 0.100000000000D+01 0.183000000000D+04 0.000000000000D+00;
%     0.200000000000D+01 0.000000000000D+00 -0.107102096081D-07 0.430000000000D+02;
%     0.721800000000D+04 0.400000000000D+01 0.000000000000D+00 0.000000000000D+00];

 A=[
    0.360000000000D+02 -0.631250000000D+01 0.475448375762D-08 -0.212791215846D+01;
   -0.497326254845D-06 0.221100087510D-01 0.987388193607D-05 0.515362296867D+04;
    0.143840000000D+05 0.279396772385D-06 0.599466231889D-01 -0.115483999252D-06;
    0.933845769830D+00 0.168218750000D+03 -0.195314947482D+01 -0.770424948434D-08;
    0.482162941165D-09 0.000000000000D+00 0.183000000000D+04 0.000000000000D+00;
    0.200000000000D+01 0.000000000000D+00 -0.116415321827D-07 0.360000000000D+02;
    0.750000000000D+04 0.400000000000D+01 0.000000000000D+00 0.000000000000D+00;];

%  A=[
%     0.900000000000D+02 0.912500000000D+01 0.564344935803D-08 0.266609273045D+01;
%     0.424683094025D-06 0.743098265957D-02 0.497512519360D-05 0.515369568062D+04;
%     0.144000000000D+05 0.540167093277D-07 0.110500905033D+01 -0.819563865662D-07;
%     0.922740474885D+00 0.263562500000D+03 -0.206792089725D+01 -0.845499504162D-08;
%     0.162506769059D-09 0.000000000000D+00 0.183000000000D+04 0.000000000000D+00;
%     0.280000000000D+01 0.000000000000D+00 -0.176951289177D-07 0.900000000000D+02;
%     0.720000000000D+04 0.400000000000D+01 0.000000000000D+00 0.000000000000D+00;];



sqrtA = A(2,4);        %: (3,4)
delta_n =A(1,3);       %: (2,3)
toe = A(3,1);           %: (4,1)
M0 = A(1,4);           %: (2,4)
e = A(2,2);             %: (3,2)
omega =  A(4,3);         %: (5,3)
Cuc = A(2,1);           %: (3,1)
Cus =  A(2,3);          %: (3,3)
Crc =  A(4,2);          %: (5,2)
Crs = A(1,2);           %: (2,2)
Cic =A(3,2);           %: (4,2)
Cis = A(3,4);           %: (4,4)
i0 = A(4,1);            %: (5,1)
i_dot = A(5,1);         %: (6,1)
Omega0 = A(3,3);        %: (4,3)
Omega_dot = A(4,4);    %: (5,4)

% Step 1
mu = 3.986005e14;
omegaE = 7.2921151467e-5;

% Step 2
a = sqrtA^2;
n0 = sqrt(mu/a^3);

% Step 3
n = n0 + delta_n;

% Step 4

tk =  17100-14384;

% Step 5
Mk = M0 + n*tk;

% Step 6
Ek = solveKeplerEq(Mk, e);

% Step 7 
fk =  atan2((sqrt(1 - e^2)*sin(Ek)), (cos(Ek) - e));

% Step 8
phik = fk + omega;

% Step 9
delta_uk = Cus*sin(2*phik) + Cuc*cos(2*phik);
delta_rk = Crs*sin(2*phik) + Crc*cos(2*phik);
delta_ik = Cis*sin(2*phik) + Cic*cos(2*phik);

% Step 10
uk = phik + delta_uk;
rk = a*(1 - e*cos(Ek)) + delta_rk;
ik = i0 + delta_ik + i_dot*tk;

% Step 11
xkp = rk*cos(uk);
ykp = rk*sin(uk);

% Step 12
Omegak = Omega0 + (Omega_dot - omegaE)*tk - omegaE*toe;

% Step 13
xk = xkp*cos(Omegak) - ykp*cos(ik)*sin(Omegak);
yk = xkp*sin(Omegak) + ykp*cos(ik)*cos(Omegak);
zk = ykp*sin(ik);
fprintf(1,"%f %f %f",xk,yk,zk)
